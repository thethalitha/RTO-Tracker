<!DOCTYPE html>
<html>
<head>
  <title>RTO & OOO Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, button, select, textarea { margin: 10px 0; }
    .section { border-top: 1px solid #ccc; margin-top: 40px; padding-top: 20px; }
    textarea { width: 300px; height: 60px; resize: vertical; }
  </style>
</head>
<body>
  <h2>üßë‚Äçüíº Return to Office - Weekly Poll</h2>
  <label>
    Name: <input type="text" id="name" oninput="prefillDays()" />
  </label><br/>
  <p>Select the days you'll be in the office (or none):</p>
  <div id="days">
    <label><input type="checkbox" name="day" value="Monday"> Monday</label><br/>
    <label><input type="checkbox" name="day" value="Tuesday"> Tuesday</label><br/>
    <label><input type="checkbox" name="day" value="Wednesday"> Wednesday</label><br/>
    <label><input type="checkbox" name="day" value="Thursday"> Thursday</label><br/>
    <label><input type="checkbox" name="day" value="Friday"> Friday</label><br/>
  </div>
  <button onclick="submitChoice()">Submit</button>

  <h3>üìä Office Attendance Dashboard</h3>
  <div id="dashboard"></div>

  <!-- OOO SECTION -->
  <div class="section">
    <h2>üå¥ Out of Office (OOO) Submission</h2>
    <label>
      Name: <input type="text" id="ooo-name" />
    </label><br/>
    <label>
      Start Date: <input type="date" id="ooo-start-date" />
    </label><br/>
    <label>
      End Date: <input type="date" id="ooo-end-date" />
    </label><br/>
    <label>
      Type:
      <select id="ooo-type" onchange="toggleRemark()">
        <option value="Local">Local Leave</option>
        <option value="Overseas">Overseas Leave</option>
      </select>
    </label><br/>
    <div id="remark-container" style="display:none;">
      <label>
        Remark (for Local Leave):
        <br/>
        <textarea id="ooo-remark" placeholder="Short details here..."></textarea>
      </label>
    </div>
    <button onclick="submitOOO()">Submit OOO</button>

    <h3>üìÖ OOO Calendar</h3>
    <div id="ooo-dashboard"></div>
  </div>

  <script>
    // RTO logic
    let rtoData = JSON.parse(localStorage.getItem('rtoData') || '{}');

    function submitChoice() {
      const name = document.getElementById('name').value.trim();
      const checkboxes = document.querySelectorAll('input[name="day"]:checked');
      const days = Array.from(checkboxes).map(cb => cb.value);

      if (!name) {
        alert("Please enter your name.");
        return;
      }

      rtoData[name] = days; // can be empty if none selected
      localStorage.setItem('rtoData', JSON.stringify(rtoData));
      renderDashboard();
      alert("Your selection has been saved.");
    }

    function renderDashboard() {
      const summary = { Monday: [], Tuesday: [], Wednesday: [], Thursday: [], Friday: [] };
      let noDays = [];

      for (const [name, days] of Object.entries(rtoData)) {
        if (days.length === 0) {
          noDays.push(name);
        } else {
          days.forEach(day => {
            if (summary[day]) summary[day].push(name);
          });
        }
      }

      let html = '';
      for (const [day, names] of Object.entries(summary)) {
        html += `<b>${day}:</b> ${names.join(', ') || '-'} (${names.length})<br/>`;
      }

      html += `<br/><b>Working remotely (no office days):</b> ${noDays.join(', ') || '-'} (${noDays.length})`;
      document.getElementById('dashboard').innerHTML = html;
    }

    function prefillDays() {
      const name = document.getElementById('name').value.trim();
      const days = rtoData[name] || [];
      document.querySelectorAll('input[name="day"]').forEach(cb => {
        cb.checked = days.includes(cb.value);
      });
    }

    renderDashboard();

    // OOO logic
    let oooData = JSON.parse(localStorage.getItem('oooData') || '{}');

    function toggleRemark() {
      const type = document.getElementById('ooo-type').value;
      document.getElementById('remark-container').style.display = (type === 'Local') ? 'block' : 'none';
    }

    toggleRemark(); // initialize on load

    function submitOOO() {
      const name = document.getElementById('ooo-name').value.trim();
      const startDate = document.getElementById('ooo-start-date').value;
      const endDate = document.getElementById('ooo-end-date').value;
      const type = document.getElementById('ooo-type').value;
      const remark = document.getElementById('ooo-remark').value.trim();

      if (!name || !startDate || !endDate) {
        alert("Please enter name, start date, and end date.");
        return;
      }

      if (endDate < startDate) {
        alert("End date cannot be before start date.");
        return;
      }

      // Store leave for each date in the range
      const start = new Date(startDate);
      const end = new Date(endDate);

      for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        const dateStr = d.toISOString().slice(0,10); // YYYY-MM-DD

        if (!oooData[dateStr]) {
          oooData[dateStr] = [];
        }

        // Remove existing entry for same person on this date
        oooData[dateStr] = oooData[dateStr].filter(entry => entry.name !== name);

        oooData[dateStr].push({ name, type, remark: type === 'Local' ? remark : '' });
      }

      localStorage.setItem('oooData', JSON.stringify(oooData));
      renderOOO();
      alert("Your OOO leave has been saved.");
    }

    function renderOOO() {
      let html = '';
      const sortedDates = Object.keys(oooData).sort();

      for (const date of sortedDates) {
        const entries = oooData[date];
        html += `<b>${date}:</b> `;
        html += entries.map(e => {
          const rmk = e.type === 'Local' && e.remark ? ` - ${e.remark}` : '';
          return `${e.name} (${e.type}${rmk})`;
        }).join(', ');
        html += `<br/>`;
      }

      document.getElementById('ooo-dashboard').innerHTML = html;
    }

    renderOOO();
  </script>
</body>
</html>
